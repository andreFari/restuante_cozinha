<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Painel Cozinha</title>
    <link rel="stylesheet" href="css/css.css" />
    <link rel="stylesheet" href="css/header.css" />

    <style>
      /* ===== Reset & Font ===== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f7f8fa;
        color: #333;
      }

      h1,
      h3,
      h4 {
        margin-bottom: 0.75rem;
        font-weight: 600;
      }

      h1 {
        font-size: 1rem;
        margin-bottom: 1rem;
        margin-left: 3%;
        margin-top: 1%;
      }

      h3 {
        font-size: 1.25rem;
      }

      h4 {
        font-size: 1rem;
      }

      p {
        margin-bottom: 1rem;
        line-height: 1.5;
      }

      /* ===== Buttons ===== */
      .btn {
        padding: 14px 24px;
        background: #007bff;
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        font-size: 1.05rem;
        transition: all 0.2s ease;
      }

      .btn-primary {
        background-color: #007bff;
        color: white;
        height: 70px;
        width: 200px;
      }

      .btn-primary:hover {
        background-color: #0056b3;
      }

      .btn-secondary {
        background-color: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background-color: #565e64;
      }

      /* ===== Painel Cozinha Layout ===== */
      .container {
        display: flex;
        padding: 20px;
        gap: 20px;
      }

      .table-list {
        width: 30%;
        max-width: 300px;
        background-color: #fff;
        padding: 10px;
        border-radius: 6px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
        height: calc(100vh - 100px);
      }

      .table-item {
        padding: 12px;
        margin-bottom: 10px;
        background-color: #f9f9f9;
        border-left: 5px solid #198754;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .table-item:hover {
        background-color: #f1f1f1;
      }

      .order-details {
        flex-grow: 1;
        background-color: #fff;
        padding: 20px;
        border-radius: 6px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        height: fit-content;
        max-width: 100%;
      }

      .section-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 12px;
      }

      .section-column {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .section {
        background-color: #fdfdfd;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        margin-bottom: 20px;
        padding: 15px;
      }

      .section h3 {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 1.1rem;
        color: #495057;
        grid-column: span 5;
      }

      .item {
        display: flex;
        align-items: center;
        padding: 12px;
        background: #f1f1f1;
        border-radius: 6px;
        cursor: pointer;
        user-select: none;
        transition: background 0.2s;
      }

      .item input {
        pointer-events: none;
        transform: scale(1.4);
        margin-right: 8px;
      }

      .item:hover {
        background: #e2e6ea;
      }

      .status {
        display: inline-block;
        font-size: 0.9em;
        padding: 5px 10px;
        border-radius: 20px;
        margin-bottom: 15px;
        font-weight: bold;
      }

      .status.paid {
        background-color: #d1e7dd;
        color: #0f5132;
      }

      .status.unpaid {
        background-color: #f8d7da;
        color: #842029;
      }

      @media (max-width: 768px) {
        .container {
          flex-direction: column;
        }

        .table-list {
          width: 100%;
          max-height: 300px;
        }

        .order-details {
          width: 100%;
        }
      }

      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        gap: 20px;
        flex-wrap: wrap;
      }

      .order-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #212529;
        flex-shrink: 0;
      }

      .admin-note-short {
        background-color: #e9ecef;
        padding: 10px 15px;
        border-radius: 5px;
        font-size: 0.95rem;
        max-width: 60%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #495057;
        cursor: default;
      }
    </style>
  </head>

  <body>
    <header>
      <div class="logo-title">
        <img src="" alt="Logo" class="logo" />
      </div>

      <div class="links-container">
        <nav id="navLinks">
          <a href="./login.html" class="protected"> Rece√ß√£o Bar </a>
          <a href="./rececaoCozi.html" class="protected"> Rece√ß√£o Cozinha </a>
          <a href="./cozinha.html" class="protected active"> Cozinha </a>
          <a href="./faturas.html" class="protected">üìÑ Ver Faturas</a>
          <a href="./guiasTransporte.html" class="protected"
            >üöö Guias de Transporte
          </a>

          <a href="./artigos.html" class="protected">üçΩÔ∏è Gerir Pratos</a>
        </nav>
      </div>
    </header>
    <div style="padding: 20px">
      <div class="container">
        <div class="table-list" id="tableList"></div>
        <div class="order-details" id="orderDetails">
          <p>Selecione uma mesa para ver os detalhes do pedido.</p>
        </div>
      </div>
    </div>
    <script>
      const tables = [
        {
          id: 1,
          name: "Mesa 1",
          open: true,
          kitchenNote: "Tens que fazer mais uma de frango",
          order: {
            status: "unpaid",
            plates: ["Frango Assado", "Sopa"],
            extras: ["Batatas Fritas"],
            drinks: ["√Ågua", "Vinho"],
            desserts: ["Bolo"],
            coffee: ["Expresso"],
          },
          prepared: {
            plates: [false, false],
            extras: [false],
            drinks: [false, false],
            desserts: [false],
            coffee: [false],
          },
        },
        {
          id: 2,
          name: "Mesa 2",
          open: false,
          kitchenNote: "",
          order: {
            status: "paid",
            plates: ["Peixe Grelhado"],
            extras: [],
            drinks: ["Cerveja"],
            desserts: [],
            coffee: [],
          },
          prepared: {
            plates: [true],
            extras: [],
            drinks: [true],
            desserts: [],
            coffee: [],
          },
        },
        {
          id: 3,
          name: "Mesa 3",
          open: true,
          kitchenNote: "",
          order: {
            status: "paid",
            plates: ["Bife"],
            extras: ["Arroz"],
            drinks: ["Sumo"],
            desserts: [],
            coffee: [],
          },
          prepared: {
            plates: [true],
            extras: [true],
            drinks: [true],
            desserts: [],
            coffee: [],
          },
        },
      ];

      const tableList = document.getElementById("tableList");
      const orderDetails = document.getElementById("orderDetails");
      function renderTables() {
        tableList.innerHTML = "";

        const openTables = tables.filter((t) => t.open);
        const closedTables = tables.filter((t) => !t.open);

        if (openTables.length) {
          const openHeader = document.createElement("h3");
          openHeader.textContent = "Mesas Abertas  Painel Cozinha";
          tableList.appendChild(openHeader);

          openTables.forEach((table, index) => {
            const div = document.createElement("div");
            div.className = "table-item open";
            div.textContent = table.name;
            div.onclick = () => renderOrderDetails(index);
            tableList.appendChild(div);
          });
        }

        if (closedTables.length) {
          const closedHeader = document.createElement("h3");
          closedHeader.textContent = "Mesas Fechadas";
          tableList.appendChild(closedHeader);

          closedTables.forEach((table, index) => {
            const div = document.createElement("div");
            div.className = "table-item closed";
            div.style.opacity = "0.6"; // indicar que est√° fechada
            div.textContent = table.name;
            div.onclick = () => renderOrderDetails(index);
            tableList.appendChild(div);
          });
        }
      }

      function renderOrderDetails(index) {
        const table = tables[index];
        const order = table.order;
        const prepared = table.prepared;

        function renderSection(title, items, prepState, key) {
          if (items.length === 0) return "";
          return `
    <div class="section section-column">
      <h3>${title}</h3>
      ${items
        .map(
          (item, i) => `
        <div class="item" onclick="togglePrepared(${index}, '${key}', ${i})">
          <input type="checkbox" ${
            table.open ? (prepState[i] ? "checked" : "") : "disabled"
          }>
          <label>${item}</label>
        </div>`
        )
        .join("")}
    </div>
  `;
        }
        orderDetails.innerHTML = `
    <div class="order-header">
      <div class="order-title">${table.name} - ${
          table.open ? "Aberta" : "Fechada"
        }</div>
      <div class="admin-note-short" title="${
        table.kitchenNote ? table.kitchenNote : "Nenhuma nota do admin."
      }">
        ${table.kitchenNote ? table.kitchenNote : "Nenhuma nota do admin."}
      </div>
    </div>

    <!-- Nota da Cozinha -->
<div class="section section-grid">
  <label for="kitchenNote" style="font-weight:500; display:block;">Nota da Cozinha:</label>
  <input type="text" 
         id="kitchenNote" 
         placeholder="" 
         style="width:100%; box-sizing:border-box; padding:0px; border-radius:6px; border:1px solid #ccc;" 
         maxlength="250">
  <button class="btn btn-primary" onclick="saveKitchenNote(${index})">Guardar Nota</button>
</div>
  

  
<div class="section-grid">
${renderSection("Pratos", order.plates, prepared.plates, "plates")}

${renderSection("Bebidas", order.drinks, prepared.drinks, "drinks")}
${renderSection("Extras", order.extras, prepared.extras, "extras")}
${renderSection("Sobremesas", order.desserts, prepared.desserts, "desserts")}
${renderSection("Caf√©s", order.coffee, prepared.coffee, "coffee")}
</div>
<div class="section" style="align-items:center;">
  <h3 style="text-align: center; margin-bottom:10xp; ">Informar Rece√ß√£o</h3>
  
  <!-- First 3 buttons centered -->
  <div style="display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
    
    <button class="btn btn-warning" 
            onclick="setKitchenNote(${index}, ' PRATOS FEITOS , falta sobremesas e/ou caf√©s')" 
            style="height: 50px; min-width: 180px; font-size: 1rem; border-radius: 10px; background-color: #ffc107; font-weight: 600;">
      Pratos feitos, falta sobremesas e/ou caf√©s
    </button>

    <button class="btn btn-info" 
            onclick="setKitchenNote(${index}, ' PRATOS FEITOS, este pedido n√£o tem sobremesas ou caf√©s')" 
            style="height: 50px; min-width: 180px; font-size: 1rem; border-radius: 10px; background-color: #007bff; color: #fff; font-weight: 600;">
      Este pedido n√£o tem sobremesas ou caf√©s
    </button>

    <button class="btn btn-secondary" 
            onclick="setKitchenNote(${index}, '' )" 
            style="height: 50px; min-width: 180px; font-size: 1rem; border-radius: 10px; background-color: #6c757d; color: #fff; font-weight: 600;">
      Limpar Nota
    </button>

  </div>

  <!-- Last button -->
  <div style="text-align:center; margin-top:20px">
    <button class="btn btn-success" 
            onclick="markAsFinished(${index})" 
            style="height: 50px; min-width: 180px; font-size: 1rem; border-radius: 12px; background-color: green; color: #fff; font-weight: 500;">
      Marcar como Terminada
    </button>
  </div>
</div>

`;
      }

      window.togglePrepared = function (tableIndex, section, itemIndex) {
        tables[tableIndex].prepared[section][itemIndex] =
          !tables[tableIndex].prepared[section][itemIndex];
        renderOrderDetails(tableIndex);
      };

      window.setKitchenNote = function (tableIndex, note) {
        tables[tableIndex].kitchenNote = note;
        renderTables();
        renderOrderDetails(tableIndex);
      };
      // Salvar nota da cozinha
      window.saveKitchenNote = function (index) {
        const note = document.getElementById("kitchenNote").value;
        tables[index].kitchenNote = note;
        renderTables();
        renderOrderDetails(index);
      };

      // Alternar status Pago / Por Pagar
      window.togglePaid = function (index) {
        tables[index].order.status =
          tables[index].order.status === "paid" ? "unpaid" : "paid";
        renderOrderDetails(index);
      };
      // Abrir ou fechar mesa
      window.toggleOpenClose = function (index) {
        tables[index].open = !tables[index].open;
        renderTables();
        renderOrderDetails(index);
      };
      renderTables();
      // Fun√ß√£o para marcar mesa como terminada
      window.markAsFinished = function (index) {
        const table = tables[index];
        const prepared = table.prepared;
        let allPrepared = true;

        // Verifica se h√° itens n√£o preparados
        for (const section in prepared) {
          if (!prepared[section]) continue;
          if (prepared[section].some((p) => !p)) {
            allPrepared = false;
            break;
          }
        }

        if (!allPrepared) {
          // Modal de confirma√ß√£o
          const modalHtml = `
      <div id="confirmFinishModal" style="
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
      ">
        <div style="
          background: #fff;
          padding: 30px;
          border-radius: 12px;
          width: 400px;
          text-align: center;
          font-family: Arial, sans-serif;
          box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        ">
          <h2 style="margin-bottom: 20px;">Itens n√£o preparados</h2>
          <p style="margin-bottom: 30px;">Ainda n√£o est√£o todos os pedidos preparados. Tem a certeza que quer avan√ßar?</p>
          <div style="display: flex; justify-content: space-between; gap: 10px;">
            <button style="
              flex: 1;
              padding: 10px 0;
              background: orange;
              color: #fff;
              border: none;
              border-radius: 6px;
              cursor: pointer;
            " onclick="document.getElementById('confirmFinishModal').remove()">
              Cancelar
            </button>
            <button style="
              flex: 1;
              padding: 10px 0;
              background: green;
              color: #fff;
              border: none;
              border-radius: 6px;
              cursor: pointer;
            " onclick="proceedFinish(${index})">
              Avan√ßar
            </button>
          </div>
        </div>
      </div>
    `;
          document.body.insertAdjacentHTML("beforeend", modalHtml);
          return;
        }

        // Se todos preparados, termina direto
        proceedFinish(index);
      };
      // Fun√ß√£o que realmente marca a mesa como terminada
      function proceedFinish(index) {
        const table = tables[index];
        table.open = false; // Fecha a mesa
        table.order.status = "finished"; // Marca como finalizada

        // Remove modal se existir
        const modal = document.getElementById("confirmFinishModal");
        if (modal) modal.remove();

        renderTables();
        renderOrderDetails(index);
      }
    </script>
    <script src="./js/header.js"></script>
  </body>
</html>
