<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Painel Cozinha</title>
    <link rel="stylesheet" href="css/header.css" />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f8f9fa;
        color: #333;
      }

      header {
        color: white;
        padding: 1rem 2rem;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .container {
        display: flex;
        padding: 20px;
        gap: 20px;
      }

      .table-list {
        width: 30%;
        max-width: 300px;
        background-color: #fff;
        padding: 10px;
        border-radius: 6px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
        height: calc(100vh - 100px);
      }

      .table-item {
        padding: 12px;
        margin-bottom: 10px;
        background-color: #f1f1f1;
        border-left: 5px solid #198754;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .table-item:hover {
        background-color: #e2e6ea;
      }

      .order-details {
        flex-grow: 1;
        background-color: #fff;
        padding: 20px;
        border-radius: 6px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        height: fit-content;
        max-width: 100%;
      }
      .section-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 12px;
      }

      .section-grid .section {
        grid-column: span 1; /* cada secção ocupa só 1 coluna */
      }
      .section-column {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .section {
        background-color: #fdfdfd;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        margin-bottom: 20px;
        padding: 15px;
      }

      .section h3 {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 1.1rem;
        color: #495057;
        grid-column: span 5; /* mantém para quando for grid */
      }

      .item {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding: 12px;
        background: #f1f1f1;
        border-radius: 6px;
        cursor: pointer;
        user-select: none;
        transition: background 0.2s;
      }

      .item input {
        pointer-events: none; /* deixa o clique ir para o pai */
        transform: scale(1.4);
        margin-right: 8px;
      }

      .item:hover {
        background: #e2e6ea;
      }
      .status {
        display: inline-block;
        font-size: 0.9em;
        padding: 5px 10px;
        border-radius: 20px;
        margin-bottom: 15px;
        font-weight: bold;
      }

      .status.paid {
        background-color: #d1e7dd;
        color: #0f5132;
      }

      .status.unpaid {
        background-color: #f8d7da;
        color: #842029;
      }

      button {
        background-color: #0d6efd;
        color: white;
        border: none;
        padding: 10px 15px;
        margin-right: 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.95rem;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: #0b5ed7;
      }

      @media (max-width: 768px) {
        .container {
          flex-direction: column;
        }

        .table-list {
          width: 100%;
          max-height: 300px;
        }

        .order-details {
          width: 100%;
        }
      }
      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        gap: 20px;
        flex-wrap: wrap;
      }

      .order-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #212529;
        flex-shrink: 0;
      }

      .admin-note-short {
        background-color: #e9ecef;
        padding: 10px 15px;
        border-radius: 5px;
        font-size: 0.95rem;
        max-width: 60%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #495057;
        cursor: default;
      }
    </style>
  </head>

  <body>
    <div id="header-placeholder"></div>
    <div style="padding: 20px">
      <h1>Painel Cozinha</h1>
      <div class="container">
        <div class="table-list" id="tableList"></div>
        <div class="order-details" id="orderDetails">
          <p>Selecione uma mesa para ver os detalhes do pedido.</p>
        </div>
      </div>
    </div>
    <script>
      const tables = [
        {
          id: 1,
          name: "Mesa 1",
          open: true,
          kitchenNote: "Tens que fazer mais uma de frango",
          order: {
            status: "unpaid",
            plates: ["Frango Assado", "Sopa"],
            extras: ["Batatas Fritas"],
            drinks: ["Água", "Vinho"],
            desserts: ["Bolo"],
            coffee: ["Expresso"],
          },
          prepared: {
            plates: [false, false],
            extras: [false],
            drinks: [false, false],
            desserts: [false],
            coffee: [false],
          },
        },
        {
          id: 2,
          name: "Mesa 2",
          open: false,
          kitchenNote: "",
          order: {
            status: "paid",
            plates: ["Peixe Grelhado"],
            extras: [],
            drinks: ["Cerveja"],
            desserts: [],
            coffee: [],
          },
          prepared: {
            plates: [true],
            extras: [],
            drinks: [true],
            desserts: [],
            coffee: [],
          },
        },
        {
          id: 3,
          name: "Mesa 3",
          open: true,
          kitchenNote: "",
          order: {
            status: "paid",
            plates: ["Bife"],
            extras: ["Arroz"],
            drinks: ["Sumo"],
            desserts: [],
            coffee: [],
          },
          prepared: {
            plates: [true],
            extras: [true],
            drinks: [true],
            desserts: [],
            coffee: [],
          },
        },
      ];

      const tableList = document.getElementById("tableList");
      const orderDetails = document.getElementById("orderDetails");
      function renderTables() {
        tableList.innerHTML = "";

        const openTables = tables.filter((t) => t.open);
        const closedTables = tables.filter((t) => !t.open);

        if (openTables.length) {
          const openHeader = document.createElement("h3");
          openHeader.textContent = "Mesas Abertas";
          tableList.appendChild(openHeader);

          openTables.forEach((table, index) => {
            const div = document.createElement("div");
            div.className = "table-item open";
            div.textContent = table.name;
            div.onclick = () => renderOrderDetails(index);
            tableList.appendChild(div);
          });
        }

        if (closedTables.length) {
          const closedHeader = document.createElement("h3");
          closedHeader.textContent = "Mesas Fechadas";
          tableList.appendChild(closedHeader);

          closedTables.forEach((table, index) => {
            const div = document.createElement("div");
            div.className = "table-item closed";
            div.style.opacity = "0.6"; // indicar que está fechada
            div.textContent = table.name;
            div.onclick = () => renderOrderDetails(index);
            tableList.appendChild(div);
          });
        }
      }

      function renderOrderDetails(index) {
        const table = tables[index];
        const order = table.order;
        const prepared = table.prepared;

        function renderSection(title, items, prepState, key) {
          if (items.length === 0) return "";
          return `
    <div class="section section-column">
      <h3>${title}</h3>
      ${items
        .map(
          (item, i) => `
        <div class="item" onclick="togglePrepared(${index}, '${key}', ${i})">
          <input type="checkbox" ${
            table.open ? (prepState[i] ? "checked" : "") : "disabled"
          }>
          <label>${item}</label>
        </div>`
        )
        .join("")}
    </div>
  `;
        }
        orderDetails.innerHTML = `
    <div class="order-header">
      <div class="order-title">${table.name} - ${
          table.open ? "Aberta" : "Fechada"
        }</div>
      <div class="admin-note-short" title="${
        table.kitchenNote ? table.kitchenNote : "Nenhuma nota do admin."
      }">
        ${table.kitchenNote ? table.kitchenNote : "Nenhuma nota do admin."}
      </div>
    </div>

    <!-- Nota da Cozinha -->
   <div class="section section-grid">
      <label for="kitchenNote" style="font-weight:600; display:block;">Nota da Cozinha:</label>
      <textarea id="kitchenNote" rows="3" style="width:100%; box-sizing:border-box; padding:8px; border-radius:6px; border:1px solid #ccc;">${
        table.kitchenNote
      }</textarea>
      <button class="btn btn-primary" onclick="saveKitchenNote(${index})">Guardar Nota</button>
    </div>

  

  

${renderSection("Pratos", order.plates, prepared.plates, "plates")}

${renderSection("Bebidas", order.drinks, prepared.drinks, "drinks")}
${renderSection("Extras", order.extras, prepared.extras, "extras")}
${renderSection("Sobremesas", order.desserts, prepared.desserts, "desserts")}
${renderSection("Cafés", order.coffee, prepared.coffee, "coffee")}

<div class="section section-grid">
  <h3>Informar Admin</h3>
  <button onclick="setKitchenNote(${index}, ' PRATOS FEITOS , falta sobremesas e/ou cafés')">
    Pratos feitos, falta sobremesas e/ou cafés 
  </button>
  <button onclick="setKitchenNote(${index}, ' PRATOS FEITOS, este pedido não tem sobremesas ou cafés')">
    Este pedido não tem sobremesas ou cafés 
  </button>
  <button onclick="setKitchenNote(${index}, '' )" style="background-color: #6c757d;">
    Limpar Nota
  </button>
</div>
`;
      }

      window.togglePrepared = function (tableIndex, section, itemIndex) {
        tables[tableIndex].prepared[section][itemIndex] =
          !tables[tableIndex].prepared[section][itemIndex];
        renderOrderDetails(tableIndex);
      };

      window.setKitchenNote = function (tableIndex, note) {
        tables[tableIndex].kitchenNote = note;
        renderTables();
        renderOrderDetails(tableIndex);
      };
      // Salvar nota da cozinha
      window.saveKitchenNote = function (index) {
        const note = document.getElementById("kitchenNote").value;
        tables[index].kitchenNote = note;
        renderTables();
        renderOrderDetails(index);
      };

      // Alternar status Pago / Por Pagar
      window.togglePaid = function (index) {
        tables[index].order.status =
          tables[index].order.status === "paid" ? "unpaid" : "paid";
        renderOrderDetails(index);
      };
      // Abrir ou fechar mesa
      window.toggleOpenClose = function (index) {
        tables[index].open = !tables[index].open;
        renderTables();
        renderOrderDetails(index);
      };
      renderTables();
    </script>
    <script src="./js/header.js"></script>
  </body>
</html>
